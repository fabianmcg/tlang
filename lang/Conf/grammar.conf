/* 
* Parser entry point
*/
__top__:= ModuleDecl;

/* 
* Declarations
*/

ModuleDecl node:= TopLevelDeclList :{ _0 = make<ModuleDecl>("__unnamed__", _3); }:;

TopLevelDeclList @< DeclContext >@ node:=
                 E
        |        TopLevelDecl :{ DeclContext ctx; ctx.add(_0); _0 = std::move(ctx); }:
        |        TopLevelDecl TopLevelDeclList :{ _1.add(_0); _0 = std::move(_1); }:
        ;

TopLevelDecl @< unique<Decl> >@ node:=
                 NamespaceDecl
        |        TagDecl
        |        FunctionDecl
        |        VarDecl
        ;

NamespaceDecl node:= namespace Identifier "{" TopLevelDeclList "}" :{ _0 = make<NamespaceDecl>(_1, _3); }:;

TagDecl node:=
                 StructDecl
        |        EnumDecl
        ;

StructDecl node:= struct Identifier "{" "}" ";";

StructMember @< unique<Decl> >@ node:=
                 MemberDecl
        |        MethodDecl
        |        TagDecl
        ;

StructMemberList @< DeclContext >@ node:=
                 E
        |        StructMember :{ DeclContext ctx; ctx.add(_0); _0 = std::move(ctx); }:
        |        StructMember StructMemberList :{ _1.add(_0); _0 = std::move(_1); }:
        ;

FunctionDecl node:= function Identifier "(" ")" CompoundStmt :{ ; }:;

Type node:=
                 PtrType
        |        BaseType
        ;

QualType @< QualType >@ node:=
                 Type "&" :{ _0 = QualType { _0, Reference }; }:
        |        Type :{ _0 = QualType { _0 }; }:
        ;

AutoType node:= auto :{ _0 = make<AutoType>(); }:;

NamedType node:= Identifier :{ _0 = make<NamedType>(_0); }:;

BaseType @< unique<Type> >@ node:=
                 BuiltinType
        |        AutoType
        |        NamedType
        ;

PtrType @< unique<PtrType> >@ node:= BaseType asterisk :{ _0 = make<PtrType>(_0); }:;

BuiltinType node:=
                 int :{ _0 = make<BuiltinType>(Int, Int_64, Signed); }:
        |        float :{ _0 = make<BuiltinType>(Float, Float_32, Signed); }:
        |        void :{ _0 = make<BuiltinType>(Void); }:
        ;
